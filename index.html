<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Satoshi World | Panel Cyberpunk</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #05070c;
        --panel: rgba(12, 18, 32, 0.92);
        --panel-border: rgba(88, 247, 255, 0.4);
        --neon: #4ef2ff;
        --neon-2: #b44bff;
        --accent: #f7ff6d;
        --text: #e3f3ff;
        --muted: #9aa9bf;
        --danger: #ff6b88;
        --success: #37f6b2;
        --shadow: 0 0 20px rgba(78, 242, 255, 0.25);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Rajdhani", "Orbitron", "Segoe UI", system-ui, sans-serif;
        background: radial-gradient(circle at top, rgba(88, 247, 255, 0.15), transparent 55%),
          linear-gradient(140deg, #04060c, #0b0f1d 60%, #090a14);
        color: var(--text);
        min-height: 100vh;
      }

      .app {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      header {
        padding: 28px 5vw 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        justify-content: space-between;
      }

      .brand {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .brand h1 {
        margin: 0;
        font-size: clamp(1.6rem, 3vw, 2.4rem);
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      .brand span {
        color: var(--muted);
        font-size: 0.95rem;
      }

      .mode-toggle {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.95rem;
      }

      .switch {
        position: relative;
        width: 52px;
        height: 26px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 999px;
        border: 1px solid var(--panel-border);
        box-shadow: var(--shadow);
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: var(--neon);
        border-radius: 50%;
        transition: transform 0.2s ease;
      }

      .switch input:checked + .slider {
        transform: translateX(26px);
        background: var(--accent);
      }

      main {
        flex: 1;
        padding: 20px 5vw 40px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .layout {
        display: grid;
        gap: 20px;
        grid-template-columns: minmax(180px, 220px) minmax(0, 1fr) minmax(180px, 220px);
        align-items: start;
      }

      .side-tabs {
        display: flex;
        flex-direction: column;
        gap: 12px;
        position: sticky;
        top: 20px;
      }

      .side-tabs .panel {
        padding: 16px;
      }

      .tab-list {
        display: grid;
        gap: 8px;
      }

      .tab-button {
        width: 100%;
        text-align: left;
        border-radius: 10px;
        padding: 10px 12px;
        background: rgba(8, 12, 22, 0.8);
        color: var(--text);
        border: 1px solid transparent;
        font-size: 0.95rem;
        cursor: pointer;
      }

      .tab-button.active {
        border-color: rgba(78, 242, 255, 0.5);
        box-shadow: var(--shadow);
        background: rgba(78, 242, 255, 0.12);
      }

      .tab-content {
        display: none;
        gap: 10px;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .tab-content.active {
        display: grid;
      }

      .tab-content h3 {
        margin: 0;
        color: var(--text);
        font-size: 1rem;
      }

      .terminal {
        font-family: "Share Tech Mono", "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 0.85rem;
        background: rgba(5, 9, 18, 0.9);
        border-radius: 12px;
        padding: 14px;
        border: 1px solid rgba(78, 242, 255, 0.2);
        color: #a6ffdf;
        height: 240px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .terminal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8rem;
        color: var(--muted);
      }

      .terminal-log {
        display: grid;
        gap: 6px;
        overflow: hidden;
        flex: 1;
      }

      .terminal-line {
        display: flex;
        gap: 8px;
      }

      .terminal-line span {
        color: #d3fff2;
      }

      .grid {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      }

      .panel {
        background: var(--panel);
        border: 1px solid var(--panel-border);
        border-radius: 16px;
        padding: 20px;
        box-shadow: var(--shadow);
        backdrop-filter: blur(6px);
      }

      .panel h2 {
        margin-top: 0;
        font-size: 1.2rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .stat-row {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        padding: 8px 0;
        border-bottom: 1px solid rgba(78, 242, 255, 0.1);
      }

      .stat-row:last-child {
        border-bottom: none;
      }

      .stat-label {
        color: var(--muted);
        font-size: 0.95rem;
      }

      .stat-value {
        font-weight: 600;
      }

      .actions {
        display: grid;
        gap: 12px;
      }

      label {
        font-size: 0.9rem;
        color: var(--muted);
        margin-bottom: 6px;
        display: block;
      }

      input,
      select,
      textarea {
        width: 100%;
        background: rgba(8, 12, 22, 0.9);
        border: 1px solid rgba(78, 242, 255, 0.3);
        border-radius: 10px;
        padding: 10px 12px;
        color: var(--text);
        font-size: 1rem;
      }

      button {
        width: 100%;
        border: none;
        border-radius: 10px;
        padding: 12px 16px;
        background: linear-gradient(120deg, var(--neon), var(--neon-2));
        color: #0a0e1a;
        font-size: 1rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        cursor: pointer;
        text-transform: uppercase;
      }

      button.secondary {
        background: linear-gradient(120deg, rgba(78, 242, 255, 0.2), rgba(180, 75, 255, 0.35));
        color: var(--text);
      }

      .status-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 12px;
      }

      .tag {
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(78, 242, 255, 0.12);
        border: 1px solid rgba(78, 242, 255, 0.35);
        font-size: 0.8rem;
      }

      .tag.success {
        border-color: rgba(55, 246, 178, 0.5);
        color: var(--success);
      }

      .tag.warn {
        border-color: rgba(255, 107, 136, 0.5);
        color: var(--danger);
      }

      .advanced {
        display: none;
      }

      #mode-toggle:checked ~ main .advanced {
        display: block;
      }

      .advanced-block {
        display: none;
      }

      #mode-toggle:checked ~ main .advanced-block {
        display: block;
      }

      #mode-toggle:checked ~ main .advanced-panel {
        border-color: rgba(247, 255, 109, 0.6);
      }

      .footer-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .footer-actions button {
        flex: 1 1 160px;
      }

      .helper-text {
        color: var(--muted);
        font-size: 0.85rem;
        margin-top: 8px;
      }

      .callout {
        background: rgba(78, 242, 255, 0.08);
        border: 1px solid rgba(78, 242, 255, 0.3);
        border-radius: 12px;
        padding: 14px 16px;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .callout strong {
        color: var(--text);
      }

      .inline-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .inline-actions button {
        flex: 1 1 160px;
      }

      .wallet-status {
        display: grid;
        gap: 6px;
        font-size: 0.95rem;
      }

      .wallet-status span {
        color: var(--muted);
      }

      .list {
        display: grid;
        gap: 10px;
        margin-top: 12px;
      }

      .list-item {
        border: 1px solid rgba(78, 242, 255, 0.2);
        border-radius: 12px;
        padding: 12px;
        background: rgba(6, 10, 20, 0.6);
      }

      .list-item h3 {
        margin: 0 0 6px;
        font-size: 1rem;
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.8rem;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(55, 246, 178, 0.5);
        color: var(--success);
      }

      .status-pill.warn {
        border-color: rgba(255, 107, 136, 0.5);
        color: var(--danger);
      }

      .status-pill.neutral {
        border-color: rgba(78, 242, 255, 0.4);
        color: var(--neon);
      }

      .divider {
        height: 1px;
        width: 100%;
        background: rgba(78, 242, 255, 0.12);
        margin: 12px 0;
      }

      @media (max-width: 720px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }

        .mode-toggle {
          width: 100%;
          justify-content: space-between;
        }

        .layout {
          grid-template-columns: 1fr;
        }

        .side-tabs {
          position: static;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          scroll-behavior: auto !important;
          transition: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <div class="brand">
          <h1>Satoshi World</h1>
          <span>Panel de control • Ciudad cibernética</span>
        </div>
        <div class="mode-toggle">
          <span>Modo básico</span>
          <label class="switch" for="mode-toggle" aria-label="Alternar modo avanzado">
            <input id="mode-toggle" type="checkbox" />
            <span class="slider"></span>
          </label>
          <span>Modo avanzado</span>
        </div>
      </header>

      <main>
        <section class="layout">
          <aside class="side-tabs" aria-label="Pestañas laterales">
            <div class="panel">
              <h2>White paper</h2>
              <div class="tab-list" role="tablist" aria-label="Secciones informativas">
                <button class="tab-button active" type="button" role="tab" aria-selected="true" data-tab="whitepaper">
                  White paper
                </button>
                <button class="tab-button" type="button" role="tab" aria-selected="false" data-tab="citymap">
                  Mapa de ciudad
                </button>
                <button class="tab-button" type="button" role="tab" aria-selected="false" data-tab="economy">
                  Economía circular
                </button>
                <button class="tab-button" type="button" role="tab" aria-selected="false" data-tab="community">
                  Comunidad
                </button>
              </div>
            </div>
            <div class="panel">
              <div class="tab-content active" id="tab-whitepaper" role="tabpanel">
                <h3>Funciones clave</h3>
                <p>
                  1) Panel de control con wallet Web3. 2) Registro de bots y tareas en tiempo real. 3) Laboratorio de
                  proyectos con scripts verificables. 4) Orquestación de pagos y reputación en cadena. 5) Panel de
                  seguridad con auditorías automáticas.
                </p>
                <p>
                  La visión es conectar infraestructura urbana, datos abiertos y capital comunitario. Los módulos
                  crecen por capas: básico (control), coordinación (bots), expansión (mercado).
                </p>
              </div>
              <div class="tab-content" id="tab-citymap" role="tabpanel">
                <h3>Mapa vivo</h3>
                <p>Sector 01: energía solar • Sector 02: reciclaje • Sector 03: movilidad autónoma • Sector 04: agua limpia.</p>
                <p>Integración futura: mapas 3D, alertas y rutas de misión por barrio.</p>
              </div>
              <div class="tab-content" id="tab-economy" role="tabpanel">
                <h3>Economía circular</h3>
                <p>Tokens por impacto real, incentivos a reciclaje, puntos por mantenimiento y reputación pública.</p>
                <p>Modelo híbrido: donaciones, microservicios y financiación distribuida.</p>
              </div>
              <div class="tab-content" id="tab-community" role="tabpanel">
                <h3>Comunidad</h3>
                <p>Gobernanza abierta, votaciones locales, prioridades de misión y votación por barrios.</p>
                <p>Un hub para ciudadanía, ONGs y empresas con herramientas compartidas.</p>
              </div>
            </div>
          </aside>

          <div class="content">
            <section class="panel" aria-labelledby="mission-title">
              <h2 id="mission-title">Ciudad viva: 10K bots + personas</h2>
              <p class="callout">
                <strong>Objetivo:</strong> todo lo que ves en la web debe conectarse a infraestructura real. Esta versión
                ya permite operar con wallet Web3, registrar proyectos y coordinar bots desde la interfaz. Puedes
                enlazar tu API de producción para que funcione como panel completo.
              </p>
              <div class="grid">
                <div>
                  <label for="api-base">API base (opcional)</label>
                  <input id="api-base" type="url" placeholder="https://api.tuciudad.com" aria-label="API base" />
                  <p class="helper-text">Si defines una API, las acciones se enviarán a producción automáticamente.</p>
                </div>
                <div class="wallet-status" aria-live="polite">
                  <strong>Estado de infraestructura</strong>
                  <div><span>API:</span> <span id="api-status">Sin configurar</span></div>
                  <div><span>Wallet:</span> <span id="wallet-status">No conectada</span></div>
                  <div><span>Red:</span> <span id="network-status">Desconocida</span></div>
                </div>
              </div>
            </section>

            <section class="grid">
              <article class="panel" aria-labelledby="balance-title">
                <h2 id="balance-title">Balance</h2>
                <div class="stat-row">
                  <span class="stat-label">Saldo total</span>
                  <span class="stat-value">₿ 12.480,55</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Disponible</span>
                  <span class="stat-value">₿ 9.204,21</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Bloqueado</span>
                  <span class="stat-value">₿ 3.276,34</span>
                </div>
                <div class="status-tags">
                  <span class="tag success">Bóveda cifrada</span>
                  <span class="tag">Optimización activa</span>
                  <span class="tag warn">2 alertas</span>
                </div>
              </article>

              <article class="panel" aria-labelledby="send-title">
                <h2 id="send-title">Enviar / Recibir</h2>
                <div class="actions">
                  <button type="button" class="secondary" data-action="connect-wallet" aria-label="Conectar wallet Web3">
                    Conectar wallet Web3
                  </button>
                  <div>
                    <label for="send-to">Dirección destino</label>
                    <input id="send-to" type="text" placeholder="sat://wallet/0x..." aria-label="Dirección destino" />
                  </div>
                  <div>
                    <label for="send-amount">Cantidad</label>
                    <input id="send-amount" type="number" placeholder="0.00" aria-label="Cantidad a enviar" />
                  </div>
                  <button type="button" data-action="send" aria-label="Enviar fondos">Enviar fondos</button>
                  <button type="button" class="secondary" data-action="receive" aria-label="Generar QR de recepción">
                    Generar QR de recepción
                  </button>
                </div>
              </article>

              <article class="panel" aria-labelledby="activity-title">
                <h2 id="activity-title">Actividad</h2>
                <div class="stat-row">
                  <span class="stat-label">Última transacción</span>
                  <span class="stat-value">hace 2 min</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Operaciones pendientes</span>
                  <span class="stat-value">3</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Nodo preferido</span>
                  <span class="stat-value">Omega-7</span>
                </div>
                <button type="button" class="secondary" data-action="activity" aria-label="Ver actividad completa">
                  Ver actividad completa
                </button>
              </article>
            </section>

            <section class="grid">
              <article class="panel" aria-labelledby="bots-title">
                <h2 id="bots-title">Bots en acción</h2>
                <div class="actions">
                  <div>
                    <label for="bot-task">Tarea del bot</label>
                    <input id="bot-task" type="text" placeholder="Ej: limpiar avenida, reparar luminaria" />
                  </div>
                  <div>
                    <label for="bot-budget">Presupuesto (₿)</label>
                    <input id="bot-budget" type="number" min="0" step="0.01" placeholder="0.00" />
                  </div>
                  <button type="button" data-action="deploy-bot">Desplegar bot</button>
                  <button type="button" class="secondary" data-action="toggle-autopay">Auto-pago coordinado</button>
                  <p class="helper-text" id="autopay-status">Auto-pago: apagado</p>
                </div>
                <div class="divider"></div>
                <div class="list" id="bot-list" aria-live="polite"></div>
              </article>

              <article class="panel" aria-labelledby="terminal-title">
                <h2 id="terminal-title">Terminal de 10K bots</h2>
                <div class="terminal" aria-live="polite">
                  <div class="terminal-header">
                    <span>Simulación de aprendizaje: 10.000 bots entrenando</span>
                    <span id="terminal-clock">00:00:00</span>
                  </div>
                  <div class="terminal-log" id="terminal-log"></div>
                </div>
                <p class="helper-text">
                  Vista simplificada del aprendizaje colectivo, mejoras de modelos y progreso del ecosistema. Cambia al modo
                  avanzado para más detalles.
                </p>
              </article>
            </section>

            <section class="grid advanced-block">
              <article class="panel" aria-labelledby="network-title">
                <h2 id="network-title">Estado de red</h2>
                <div class="stat-row">
                  <span class="stat-label">Latencia</span>
                  <span class="stat-value">42 ms</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Peers activos</span>
                  <span class="stat-value">128</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Ancho de banda</span>
                  <span class="stat-value">1.2 Gbps</span>
                </div>
                <button type="button" class="secondary" data-action="sync" aria-label="Sincronizar red">
                  Sincronizar red
                </button>
              </article>

              <article class="panel" aria-labelledby="sync-title">
                <h2 id="sync-title">Sincronización</h2>
                <div class="stat-row">
                  <span class="stat-label">Altura de bloque</span>
                  <span class="stat-value">8,492,010</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Progreso</span>
                  <span class="stat-value">97%</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Tiempo estimado</span>
                  <span class="stat-value">7 min</span>
                </div>
                <div class="status-tags">
                  <span class="tag success">Canal cuántico estable</span>
                  <span class="tag">Turbo sync</span>
                </div>
              </article>

              <article class="panel" aria-labelledby="security-title">
                <h2 id="security-title">Seguridad</h2>
                <div class="stat-row">
                  <span class="stat-label">Copia de seguridad</span>
                  <span class="stat-value">Actualizada hoy</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Seed</span>
                  <span class="stat-value">Vault 2/3</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Firewall</span>
                  <span class="stat-value">Activo</span>
                </div>
                <button type="button" class="secondary" data-action="backup" aria-label="Gestionar copias de seguridad">
                  Gestionar copias de seguridad
                </button>
              </article>
            </section>

            <section class="grid advanced-block">
              <article class="panel" aria-labelledby="mining-title">
                <h2 id="mining-title">Minería / Quantum</h2>
                <div class="stat-row">
                  <span class="stat-label">Rendimiento</span>
                  <span class="stat-value">92 TH/s</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Núcleos activos</span>
                  <span class="stat-value">48</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">Eficiencia</span>
                  <span class="stat-value">83%</span>
                </div>
                <div class="actions">
                  <button type="button" data-action="mine" aria-label="Iniciar minería cuántica">
                    Iniciar minería cuántica
                  </button>
                  <button type="button" class="secondary" data-action="optimize" aria-label="Optimizar minería">
                    Optimizar nodos
                  </button>
                </div>
              </article>

              <article class="panel advanced advanced-panel" aria-labelledby="advanced-title">
                <h2 id="advanced-title">Configuración avanzada</h2>
                <div class="actions">
                  <div>
                    <label for="routing">Ruteo multicanal</label>
                    <select id="routing" aria-label="Ruteo multicanal">
                      <option>Auto</option>
                      <option>Canal 7</option>
                      <option>Canal 12</option>
                      <option>Canal 21</option>
                    </select>
                  </div>
                  <div>
                    <label for="quantum">Algoritmo cuántico</label>
                    <select id="quantum" aria-label="Algoritmo cuántico">
                      <option>Q-Flux</option>
                      <option>Neutrino Pulse</option>
                      <option>Photon Forge</option>
                    </select>
                  </div>
                  <div>
                    <label for="threshold">Umbral de confirmación</label>
                    <input id="threshold" type="number" placeholder="6" aria-label="Umbral de confirmación" />
                  </div>
                  <button
                    type="button"
                    class="secondary"
                    data-action="save-settings"
                    aria-label="Guardar configuración avanzada"
                  >
                    Guardar configuración
                  </button>
                  <p class="helper-text">Panel avanzado oculto por defecto. Activa el modo avanzado para editar.</p>
                </div>
              </article>
            </section>

            <section class="grid advanced-block">
              <article class="panel" aria-labelledby="projects-title">
                <h2 id="projects-title">Programar y subir proyectos</h2>
                <div class="actions">
                  <div>
                    <label for="project-name">Nombre del proyecto</label>
                    <input id="project-name" type="text" placeholder="Ej: Jardín solar comunitario" />
                  </div>
                  <div>
                    <label for="project-desc">Descripción técnica</label>
                    <textarea id="project-desc" rows="3" placeholder="Describe cómo mejora la ciudad..."></textarea>
                  </div>
                  <div>
                    <label for="project-code">Código / Script</label>
                    <textarea id="project-code" rows="4" placeholder="// pega tu código aquí"></textarea>
                  </div>
                  <button type="button" data-action="publish-project">Publicar proyecto</button>
                </div>
                <div class="divider"></div>
                <div class="list" id="project-list" aria-live="polite"></div>
              </article>

              <article class="panel" aria-labelledby="advanced-security-title">
                <h2 id="advanced-security-title">Configuración avanzada de seguridad</h2>
                <div class="grid">
                  <div>
                    <label for="seed-notes">Notas de seed</label>
                    <textarea id="seed-notes" rows="3" placeholder="Registro cifrado..." aria-label="Notas de seed"></textarea>
                  </div>
                  <div>
                    <label for="cold-storage">Cold storage</label>
                    <select id="cold-storage" aria-label="Estado de cold storage">
                      <option>Desconectado</option>
                      <option>Verificado</option>
                      <option>En bóveda física</option>
                    </select>
                    <p class="helper-text">Mantén al menos un backup fuera de línea.</p>
                  </div>
                </div>
                <div class="footer-actions">
                  <button type="button" class="secondary" data-action="export" aria-label="Exportar configuración">
                    Exportar configuración
                  </button>
                  <button type="button" data-action="lockdown" aria-label="Activar lockdown">
                    Activar lockdown
                  </button>
                </div>
              </article>
            </section>
          </div>

          <aside class="side-tabs" aria-label="Pestañas de apoyo">
            <div class="panel">
              <h2>Centro táctico</h2>
              <div class="status-tags">
                <span class="tag success">10K bots</span>
                <span class="tag">24 distritos</span>
                <span class="tag warn">2 alertas</span>
              </div>
              <div class="divider"></div>
              <div class="list">
                <div class="list-item">
                  <h3>Prioridades hoy</h3>
                  <p class="helper-text">Iluminación • Limpieza • Seguridad nocturna.</p>
                </div>
                <div class="list-item">
                  <h3>Checklist rápido</h3>
                  <p class="helper-text">✔️ Conecta wallet • ✔️ Define API • ✔️ Lanza misión.</p>
                </div>
                <div class="list-item">
                  <h3>Radar comunitario</h3>
                  <p class="helper-text">5 barrios votando misiones nuevas.</p>
                </div>
              </div>
            </div>
            <div class="panel">
              <h2>Atajos</h2>
              <div class="inline-actions">
                <button type="button" class="secondary" data-action="deploy-bot">Nueva misión</button>
                <button type="button" class="secondary" data-action="publish-project">Publicar idea</button>
              </div>
            </div>
          </aside>
        </section>
      </main>
    </div>
    <script>
      const storage = {
        get(key, fallback) {
          try {
            const raw = localStorage.getItem(key);
            return raw ? JSON.parse(raw) : fallback;
          } catch (error) {
            return fallback;
          }
        },
        set(key, value) {
          localStorage.setItem(key, JSON.stringify(value));
        },
      };

      const state = {
        apiBase: storage.get("apiBase", ""),
        bots: storage.get("bots", []),
        projects: storage.get("projects", []),
        wallet: {
          connected: false,
          address: null,
          chainId: null,
        },
        autopay: storage.get("autopay", false),
      };

      const apiBaseInput = document.getElementById("api-base");
      const apiStatus = document.getElementById("api-status");
      const walletStatus = document.getElementById("wallet-status");
      const networkStatus = document.getElementById("network-status");
      const botList = document.getElementById("bot-list");
      const projectList = document.getElementById("project-list");
      const autopayStatus = document.getElementById("autopay-status");
      const terminalLog = document.getElementById("terminal-log");
      const terminalClock = document.getElementById("terminal-clock");
      const tabButtons = document.querySelectorAll(".tab-button");
      const tabContents = document.querySelectorAll(".tab-content");

      const formatAddress = (address) => (address ? `${address.slice(0, 6)}...${address.slice(-4)}` : "—");

      const updateInfra = () => {
        apiStatus.textContent = state.apiBase ? state.apiBase : "Sin configurar";
        walletStatus.textContent = state.wallet.connected ? formatAddress(state.wallet.address) : "No conectada";
        networkStatus.textContent = state.wallet.chainId ? state.wallet.chainId : "Desconocida";
        autopayStatus.textContent = state.autopay ? "Auto-pago: activo" : "Auto-pago: apagado";
      };

      const terminalLedgerFallback = [
        { id: 12, expertise: "algoritmos de consenso", neural_networks: 18, progress: 63 },
        { id: 42, expertise: "computación cuántica", neural_networks: 32, progress: 78 },
        { id: 87, expertise: "ciberseguridad", neural_networks: 21, progress: 71 },
        { id: 128, expertise: "optimización energética", neural_networks: 26, progress: 69 },
        { id: 203, expertise: "modelos climáticos", neural_networks: 14, progress: 58 },
        { id: 317, expertise: "bioingeniería urbana", neural_networks: 19, progress: 74 },
        { id: 402, expertise: "logística autónoma", neural_networks: 24, progress: 80 },
        { id: 519, expertise: "minería responsable", neural_networks: 11, progress: 55 },
      ];
      let terminalLedger = [];

      const loadTerminalLedger = async () => {
        try {
          const response = await fetch("agents_ledger.json", { cache: "no-store" });
          if (response.ok) {
            const data = await response.json();
            if (Array.isArray(data)) {
              terminalLedger = data;
            }
          }
        } catch (error) {
          terminalLedger = [];
        }
        if (!terminalLedger.length) {
          terminalLedger = terminalLedgerFallback;
        }
      };

      const renderTerminalLine = () => {
        const time = new Date().toLocaleTimeString("es-ES", { hour12: false });
        const entry = terminalLedger[Math.floor(Math.random() * terminalLedger.length)];
        const botId = String(entry?.id ?? 0).padStart(3, "0");
        const expertise = entry?.expertise ?? "investigación distribuida";
        const networks = entry?.neural_networks ?? 0;
        const progress = entry?.progress ?? 0;
        return `
          <div class="terminal-line">
            <span>[${time}]</span>
            <span>•</span>
            <span>Bot #${botId}</span>
            <span>•</span>
            <span>Especialista en ${expertise}</span>
            <span>•</span>
            <span>NN:${networks}</span>
            <span>•</span>
            <span>Progreso: ${progress}%</span>
          </div>
        `;
      };

      const updateTerminal = () => {
        if (!terminalLog) {
          return;
        }
        const lines = Array.from({ length: 10 }, renderTerminalLine).join("");
        terminalLog.innerHTML = lines;
        terminalClock.textContent = new Date().toLocaleTimeString("es-ES", { hour12: false });
      };

      const renderBots = () => {
        botList.innerHTML = "";
        if (!state.bots.length) {
          botList.innerHTML = "<p class='helper-text'>Sin bots activos. Despliega uno para comenzar.</p>";
          return;
        }
        state.bots.forEach((bot) => {
          const item = document.createElement("div");
          item.className = "list-item";
          item.innerHTML = `
            <h3>${bot.task}</h3>
            <div class="stat-row"><span class="stat-label">Presupuesto</span><span class="stat-value">₿ ${bot.budget}</span></div>
            <div class="stat-row"><span class="stat-label">Estado</span><span class="status-pill ${bot.statusClass}">${bot.status}</span></div>
            <div class="stat-row"><span class="stat-label">Responsable</span><span class="stat-value">${bot.owner}</span></div>
          `;
          botList.appendChild(item);
        });
      };

      const renderProjects = () => {
        projectList.innerHTML = "";
        if (!state.projects.length) {
          projectList.innerHTML = "<p class='helper-text'>Aún no hay proyectos publicados.</p>";
          return;
        }
        state.projects.forEach((project) => {
          const item = document.createElement("div");
          item.className = "list-item";
          item.innerHTML = `
            <h3>${project.name}</h3>
            <p class="helper-text">${project.description}</p>
            <div class="stat-row"><span class="stat-label">Autor</span><span class="stat-value">${project.owner}</span></div>
            <div class="stat-row"><span class="stat-label">Estado</span><span class="status-pill neutral">${project.status}</span></div>
          `;
          projectList.appendChild(item);
        });
      };

      const persist = () => {
        storage.set("apiBase", state.apiBase);
        storage.set("bots", state.bots);
        storage.set("projects", state.projects);
        storage.set("autopay", state.autopay);
      };

      const apiRequest = async (path, options = {}) => {
        if (!state.apiBase) {
          return null;
        }
        const response = await fetch(`${state.apiBase}${path}`, {
          headers: {
            "Content-Type": "application/json",
          },
          ...options,
        });
        if (!response.ok) {
          throw new Error("API error");
        }
        return response.json();
      };

      const handleConnectWallet = async () => {
        if (!window.ethereum) {
          alert("Wallet Web3 no detectada. Instala MetaMask o un proveedor compatible.");
          return;
        }
        const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
        state.wallet.connected = true;
        state.wallet.address = accounts[0];
        state.wallet.chainId = await window.ethereum.request({ method: "eth_chainId" });
        updateInfra();
      };

      const handleSend = async () => {
        const to = document.getElementById("send-to").value.trim();
        const amount = document.getElementById("send-amount").value.trim();
        if (!to || !amount) {
          alert("Completa la dirección y la cantidad.");
          return;
        }
        if (!state.wallet.connected) {
          alert("Conecta la wallet primero.");
          return;
        }
        if (!window.ethereum) {
          alert("Wallet Web3 no detectada.");
          return;
        }
        const value = `0x${Math.floor(parseFloat(amount) * 1e18).toString(16)}`;
        await window.ethereum.request({
          method: "eth_sendTransaction",
          params: [
            {
              from: state.wallet.address,
              to,
              value,
            },
          ],
        });
      };

      const handleDeployBot = async () => {
        const task = document.getElementById("bot-task").value.trim();
        const budget = document.getElementById("bot-budget").value.trim();
        if (!task || !budget) {
          alert("Completa tarea y presupuesto.");
          return;
        }
        const owner = state.wallet.connected ? formatAddress(state.wallet.address) : "Comunidad";
        const payload = {
          task,
          budget,
          owner,
        };
        try {
          const apiResult = await apiRequest("/bots", {
            method: "POST",
            body: JSON.stringify(payload),
          });
          if (apiResult) {
            state.bots = apiResult.bots ?? state.bots;
          } else {
            state.bots.unshift({
              task,
              budget,
              owner,
              status: state.autopay ? "Auto-pago activo" : "En cola",
              statusClass: state.autopay ? "neutral" : "warn",
            });
          }
        } catch (error) {
          alert("No se pudo registrar el bot en la API.");
        }
        persist();
        renderBots();
      };

      const handlePublishProject = async () => {
        const name = document.getElementById("project-name").value.trim();
        const description = document.getElementById("project-desc").value.trim();
        const code = document.getElementById("project-code").value.trim();
        if (!name || !description) {
          alert("Completa nombre y descripción.");
          return;
        }
        const owner = state.wallet.connected ? formatAddress(state.wallet.address) : "Ciudadano";
        const payload = { name, description, code, owner };
        try {
          const apiResult = await apiRequest("/projects", {
            method: "POST",
            body: JSON.stringify(payload),
          });
          if (apiResult) {
            state.projects = apiResult.projects ?? state.projects;
          } else {
            state.projects.unshift({
              name,
              description,
              owner,
              status: "Revisión comunitaria",
            });
          }
        } catch (error) {
          alert("No se pudo publicar el proyecto en la API.");
        }
        persist();
        renderProjects();
      };

      const handleAutoPay = () => {
        state.autopay = !state.autopay;
        persist();
        updateInfra();
      };

      tabButtons.forEach((button) => {
        button.addEventListener("click", () => {
          tabButtons.forEach((item) => {
            item.classList.remove("active");
            item.setAttribute("aria-selected", "false");
          });
          tabContents.forEach((content) => content.classList.remove("active"));
          button.classList.add("active");
          button.setAttribute("aria-selected", "true");
          const content = document.getElementById(`tab-${button.dataset.tab}`);
          if (content) {
            content.classList.add("active");
          }
        });
      });

      apiBaseInput.value = state.apiBase;
      apiBaseInput.addEventListener("input", (event) => {
        state.apiBase = event.target.value.trim();
        persist();
        updateInfra();
      });

      document.querySelectorAll("button[data-action]").forEach((button) => {
        button.addEventListener("click", () => {
          const action = button.dataset.action;
          if (action === "connect-wallet") {
            handleConnectWallet();
          }
          if (action === "send") {
            handleSend();
          }
          if (action === "deploy-bot") {
            handleDeployBot();
          }
          if (action === "publish-project") {
            handlePublishProject();
          }
          if (action === "toggle-autopay") {
            handleAutoPay();
          }
        });
      });

      if (window.ethereum) {
        window.ethereum.on("accountsChanged", (accounts) => {
          state.wallet.address = accounts[0] ?? null;
          state.wallet.connected = Boolean(state.wallet.address);
          updateInfra();
        });
        window.ethereum.on("chainChanged", (chainId) => {
          state.wallet.chainId = chainId;
          updateInfra();
        });
      }

      updateInfra();
      renderBots();
      renderProjects();
      loadTerminalLedger().then(() => {
        updateTerminal();
        setInterval(updateTerminal, 3500);
      });
    </script>
  </body>
</html>
